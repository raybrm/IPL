var player=0;var advers="";var winner="";var enCours=false;$(document).ready(function(){$("title").html("puissance 4");$("#disconnect").click(function(a){deleteGame(nomPartie);a.preventDefault()});$(".spa-body").append('<div class="alert alert-warning" id="game-info-alert" style="z-index: 9996;" role="alert">\n  En attente d\'un adversaire...\n</div>');wait("player")});function ready(){enCours=true;if(me==1){wait()}$("#game table tr td").click(function(b){if(player!==me||winner!==""){return}var a=this.getAttribute("data-column");if(set(a)){player=(player===1)?0:1;push(a)}})}function set(e){var a=false;for(var b=5;b>=0;b--){var d=$("#game table tr[data-row="+b+"] td[data-column="+e+"]");if(d.css("background-color")==="rgb(255, 255, 255)"){d.css("background-color",(player==1)?"yellow":"red");a=true;var c=verifWin();if(c!==false){gotWinner(c)}break}}if(!a){alert("Choisissez une autre colonne")}return a}function gotWinner(a){enCours=false;winner=(a===me)?localStorage.getItem("user.pseudo"):advers;if(winner===localStorage.getItem("user.pseudo")){var b="gagnant="+winner+"&token="+localStorage.getItem("token")+"&perdant="+advers;$.ajax({url:"/api/historic",type:"POST",data:b,dataType:"json",timeout:5000})}else{deleteGame(nomPartie)}$(".spa-body").prepend('<canvas id="canvas" style="display: block; position: fixed; width: 100%; height: 100%; z-index: 9997; background: rgba(0, 0, 0, 0.7);"></canvas><script src="./assets/js/firework.min.js"><\/script>');$(".spa-body").prepend('<button type="button" class="btn btn-outline-primary" id="winner-user-button" data-toggle="modal" data-target="#winner-user-modal" hidden></button>\n<div class="modal" data-backdrop="static" id="winner-user-modal" style="z-index: 9998;" tabindex="-1" role="dialog">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title">Nous avons un gagnant</h5>\n      </div>\n      <div class="modal-body">\n        <p>'+winner+' a gagné !</p>\n      </div>\n      <div class="modal-footer">\n        <button type="button" id="exit-winner" class="btn btn-primary" data-dismiss="modal">Retour</button>\n      </div>\n    </div>\n  </div>\n</div>');$("#winner-user-button").trigger("click");$("#exit-winner").click(function(){activeLoadDisconnected()})}function push(b){var a="nomPartie="+nomPartie+"&token="+localStorage.getItem("token")+"&pseudo="+localStorage.getItem("user.pseudo")+"&colonne="+b;$.ajax({url:"/api/playingGame",type:"POST",data:a,dataType:"json",timeout:5000,success:function(d,c){wait()},error:function(){disconnectedAdvers()}})}function wait(a){var b="nomPartie="+nomPartie+"&token="+localStorage.getItem("token");if(a!=="player"){$("#game-info-alert").html("C'est à l'adversaire de jouer...").removeClass("alert-success").addClass("alert-warning")}$.ajax({url:"/api/playingGame",type:"GET",data:b,dataType:"json",timeout:5000,success:function(d,c){if(d.success==="true"&&c==="success"){if(a==="player"){if(d.data.joueur2!==""){advers=(me==0)?d.data.joueur2:d.data.joueur1;$("#game-info-alert").html("C'est à vous de jouer...").removeClass("alert-warning").addClass("alert-success");ready()}}else{if(d.data.dernierJoueur!==""&&localStorage.getItem("user.pseudo")!==d.data.dernierJoueur){set(d.data.colonne);$("#game-info-alert").html("C'est à vous de jouer...").removeClass("alert-warning").addClass("alert-success");player=me}}}else{disconnectedAdvers()}},error:function(){disconnectedAdvers()}});setTimeout(function(){if(winner!==""||localStorage.getItem("token")==null||localStorage.getItem("token")==="null"){return}if(advers===""){wait("player");return}if(a!=="player"&&me!==player){wait()}},5000)}function verifWin(){var a;a=verifC();if(a!==false){return a}a=verifR();if(a!==false){return a}a=verifDD();if(a!==false){return a}a=verifDG();if(a!==false){return a}return false}function verifC(){for(var c=0;c<=6;c++){var d=0;var a="";for(var b=0;b<=5;b++){var e=$("#game table tr[data-row="+b+"] td[data-column="+c+"]");if(e.css("background-color")!=="rgb(255, 255, 255)"){if(a!==e.css("background-color")){d=1;a=e.css("background-color")}else{d++}}if(d>=4){return(a==="rgb(255, 0, 0)")?0:1}}}return false}function verifR(){for(var c=0;c<=5;c++){var d=0;var a="";for(var b=0;b<=6;b++){var e=$("#game table tr[data-row="+c+"] td[data-column="+b+"]");if(e.css("background-color")!=="rgb(255, 255, 255)"){if(a!==e.css("background-color")){d=1;a=e.css("background-color")}else{d++}}if(d>=4){return(a==="rgb(255, 0, 0)")?0:1}}}return false}function verifDD(){var e,d,c,a,f,b,g;for(e=0;e<=3;e++){if(e===0){for(d=3;d<=5;d++){a=0;f=0;b="";for(c=d;c>=0;c--){g=$("#game table tr[data-row="+c+"] td[data-column="+a+"]");if(g.css("background-color")!=="rgb(255, 255, 255)"){if(b!==g.css("background-color")){f=1;b=g.css("background-color")}else{f++}}if(f>=4){return(b==="rgb(255, 0, 0)")?0:1}a++}}}else{c=5;f=0;b="";for(d=e;d<=6;d++){g=$("#game table tr[data-row="+c+"] td[data-column="+d+"]");if(g.css("background-color")!=="rgb(255, 255, 255)"){if(b!==g.css("background-color")){f=1;b=g.css("background-color")}else{f++}}if(f>=4){return(b==="rgb(255, 0, 0)")?0:1}c--}}}return false}function verifDG(){var e,d,c,a,f,b,g;for(e=0;e<=3;e++){if(e===0){for(d=3;d>0;d--){a=0;f=0;b="";for(c=d;c<=6;c++){g=$("#game table tr[data-row="+a+"] td[data-column="+c+"]");if(g.css("background-color")!=="rgb(255, 255, 255)"){if(b!==g.css("background-color")){f=1;b=g.css("background-color")}else{f++}}if(f>=4){return(b==="rgb(255, 0, 0)")?0:1}a++}}}else{c=5;f=0;b="";for(d=c-e+1;d>=0;d--){g=$("#game table tr[data-row="+c+"] td[data-column="+d+"]");if(g.css("background-color")!=="rgb(255, 255, 255)"){if(b!==g.css("background-color")){f=1;b=g.css("background-color")}else{f++}}if(f>=4){return(b==="rgb(255, 0, 0)")?0:1}c--}}}return false}window.onbeforeunload=function(){deleteGame(nomPartie)};function deleteGame(a){$.ajax({url:"/api/playingGame?nomPartie="+a,type:"DELETE",dataType:"json",timeout:5000})}function disconnectedAdvers(){winner=".";$(".spa-body").prepend('<button type="button" class="btn btn-outline-primary" id="disconnected-user-button" data-toggle="modal" data-target="#disconnected-user-modal" hidden></button>\n<div class="modal" data-backdrop="static" id="disconnected-user-modal" tabindex="-1" role="dialog">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title">Erreur de partie</h5>\n      </div>\n      <div class="modal-body">\n        <p>L\'adversaire s\'est déconnecté.</p>\n      </div>\n      <div class="modal-footer">\n        <button type="button" id="exit-disconnected-error" class="btn btn-primary" data-dismiss="modal">Retour</button>\n      </div>\n    </div>\n  </div>\n</div>');$("#disconnected-user-button").trigger("click");$("#exit-disconnected-error").click(function(){activeLoadDisconnected()})}function activeLoadDisconnected(){activeLoading();setTimeout(function(){loadDashboard()},500)};